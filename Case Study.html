<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Case Study</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem;
        }
        .message-box {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .message-box.show {
            opacity: 1;
        }
        .radio-label {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .radio-label:hover {
            background-color: #e5e7eb;
        }
        .radio-label input[type="radio"] {
            margin-right: 0.75rem;
        }
        .radio-label.correct {
            background-color: #d1fae5;
            border-color: #34d399;
        }
        .radio-label.incorrect {
            background-color: #fee2e2;
            border-color: #f87171;
        }
        .reflection-question-options label {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .reflection-question-options label:hover {
            background-color: #e5e7eb;
        }
        /* Welcome modal styles */
        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 2000;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: backdrop-filter 0.5s ease;
        }

        .welcome-modal-content {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 500px;
            margin: 1rem;
            transform: scale(1);
            transition: transform 0.3s ease-out;
            animation: bounceIn 0.5s forwards;
        }

        @keyframes bounceIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Welcome Modal -->
    <div id="welcome-modal" class="welcome-modal">
        <div class="welcome-modal-content">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-4">Interactive Case Study</h1>
            <p class="text-lg text-gray-700 mb-6">
                Welcome! This activity is designed to help you build your skills in <strong>social awareness</strong> and <strong>responsible decision-making</strong>.
                <br><br>
                By analyzing a real-world scenario, you will practice identifying conflicts, understanding different perspectives, and considering the consequences of various choices. The reflection questions will guide you to think critically and apply these skills to your own life.
            </p>
            <button onclick="closeWelcomeModal()" class="px-6 py-2 bg-indigo-500 text-white font-semibold rounded-full hover:bg-indigo-600 transition-colors">Start Case Study</button>
        </div>
    </div>
    
    <div id="message-box" class="message-box bg-green-500 text-white"></div>
    <div class="max-w-4xl w-full mx-auto p-8 bg-white rounded-2xl shadow-xl">

        <!-- Case Study Section -->
        <div id="case-study-container" class="transition-opacity duration-500 ease-in-out">
            <h2 id="case-study-title" class="text-4xl font-bold text-center mb-6 text-gray-800"></h2>

            <div id="case-study-story" class="space-y-6 text-lg leading-relaxed text-gray-700">
                <!-- Case study text will be injected here by JavaScript -->
            </div>

            <!-- Comprehension Quiz Section -->
            <div id="quiz-container" class="mt-8 pt-8 border-t border-gray-300">
                <h3 id="quiz-question" class="text-2xl font-semibold text-gray-800 mb-4"></h3>
                <div id="quiz-options" class="space-y-4">
                    <!-- Quiz options will be injected here by JavaScript -->
                </div>
                <div class="flex flex-col sm:flex-row justify-center mt-6 space-y-4 sm:space-y-0 sm:space-x-4">
                    <button id="previous-btn" class="px-8 py-4 bg-gray-400 text-white font-bold rounded-full shadow-lg hover:bg-gray-500 transition-colors duration-300 transform scale-100 hover:scale-105 opacity-50 cursor-not-allowed" disabled>
                        Previous Case Study
                    </button>
                    <button id="check-answer-btn" class="px-8 py-4 bg-gray-600 text-white font-bold rounded-full shadow-lg hover:bg-gray-700 transition-colors duration-300 transform scale-100 hover:scale-105">
                        Check Answer
                    </button>
                    <button id="next-btn" class="px-8 py-4 bg-gray-400 text-white font-bold rounded-full shadow-lg hover:bg-gray-500 transition-colors duration-300 transform scale-100 hover:scale-105 opacity-50 cursor-not-allowed" disabled>
                        Next Case Study
                    </button>
                    <button id="continue-btn" class="hidden px-8 py-4 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300 transform scale-100 hover:scale-105">
                        Continue to Reflection Questions
                    </button>
                </div>
            </div>
        </div>

        <!-- Introspection Questions Section -->
        <div id="questions-container" class="hidden transition-opacity duration-500 ease-in-out opacity-0">
            <h2 class="text-4xl font-bold text-center mb-6 text-gray-800">Introspection & Reflection</h2>

            <div id="reflection-questions" class="space-y-8">
                <!-- Reflection questions and options will be injected here by JavaScript -->
            </div>

            <div class="flex justify-center mt-8">
                <button id="submit-btn" class="px-8 py-4 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300 transform scale-100 hover:scale-105">
                    Submit & Review
                </button>
                <button id="next-case-study-btn" class="hidden px-8 py-4 ml-4 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300 transform scale-100 hover:scale-105">
                    Next Case Study
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const caseStudyTitle = document.getElementById('case-study-title');
            const caseStudyStory = document.getElementById('case-study-story');
            const quizQuestion = document.getElementById('quiz-question');
            const quizOptionsContainer = document.getElementById('quiz-options');
            const previousBtn = document.getElementById('previous-btn');
            const nextBtn = document.getElementById('next-btn');
            const checkAnswerBtn = document.getElementById('check-answer-btn');
            const continueBtn = document.getElementById('continue-btn');
            const questionsContainer = document.getElementById('questions-container');
            const submitBtn = document.getElementById('submit-btn');
            const nextCaseStudyBtn = document.getElementById('next-case-study-btn');
            const messageBox = document.getElementById('message-box');
            const reflectionQuestionsContainer = document.getElementById('reflection-questions');

            let currentCaseStudyIndex = 0;
            let currentReflectionAnswered = {};

            const caseStudies = [
                {
                    title: "The Art Project: A Case Study",
                    story: `
                        <p>Chris spent weeks on his independent art project, a detailed sculpture made from recycled materials. He was passionate about his work and believed it conveyed a powerful environmental message. When he presented it to his teacher, Ms. Evans, he was excited to hear her feedback. However, Ms. Evans's critique was harsh. She said the sculpture lacked a clear focal point and that the materials were poorly integrated, giving it a messy appearance. She suggested he start over with a new plan.</p>
                        <p>Chris felt crushed. He had poured his heart into the project. He felt Ms. Evans didn't appreciate his artistic vision. He became defensive and sullen, feeling like his efforts were invalidated. He now had to decide whether to accept her feedback and create a new project, or stand by his original work and risk a lower grade.</p>
                    `,
                    quiz: {
                        question: "How did Chris react to the teacher's feedback?",
                        options: [
                            { value: "A", text: "A. He immediately agreed with her and started a new project." },
                            { value: "B", text: "B. He felt crushed and invalidated, and became defensive." },
                            { value: "C", text: "C. He was happy because he was passionate about starting a new project." },
                            { value: "D", text: "D. He ignored her completely and submitted his original work." }
                        ],
                        correctAnswer: "B",
                        feedback: {
                            "A": "This is a passive reaction. While it may seem like a good way to avoid conflict, it doesn't address Chris's feelings of being invalidated.",
                            "B": "That's right! Chris's emotional reaction of feeling crushed and defensive shows that the criticism was deeply personal for him.",
                            "C": "This is a positive reaction, but it doesn't match the situation. Chris was not happy and felt hurt by the feedback.",
                            "D": "Ignoring the feedback would be a different reaction than what happened in the story, which states that Chris became defensive and sullen."
                        }
                    },
                    reflectionQuestions: [
                        {
                            question: "1. What would be the most empathetic way for Ms. Evans to deliver her feedback?",
                            options: [
                                { value: "A", text: "A. State the problems directly and tell Chris to start over." },
                                { value: "B", text: "B. Acknowledge Chris's effort and passion before offering constructive criticism." },
                                { value: "C", text: "C. Avoid giving negative feedback and only focus on the positive aspects." }
                            ],
                            feedback: {
                                "A": "This approach is direct but can come across as blunt and unfeeling, which can make the recipient feel invalidated.",
                                "B": "This is a great approach. By acknowledging Chris's hard work, Ms. Evans validates his effort before giving constructive criticism, making it more likely to be received positively.",
                                "C": "While this avoids hurting feelings, it's not helpful. Students need honest feedback to improve their skills and grow."
                            }
                        },
                        {
                            question: "2. What is the most likely reason Chris felt so defensive?",
                            options: [
                                { value: "A", text: "A. He believes Ms. Evans is an unfair teacher." },
                                { value: "B", text: "B. He felt his personal effort and passion were being rejected, not just the project itself." },
                                { value: "C", text: "C. He was not prepared for any feedback at all." }
                            ],
                            feedback: {
                                "A": "While he might feel this way, the core reason for his defensiveness is more personal.",
                                "B": "That's a key insight. For a creative person, their work is often a part of them. The harsh critique felt like an attack on his personal value and effort, not just the art piece.",
                                "C": "He likely was prepared for feedback, but perhaps not for such a direct and harsh critique that felt personal."
                            }
                        },
                        {
                            question: "3. If Chris decides to stand by his original work, what is the most likely outcome?",
                            options: [
                                { value: "A", text: "A. The teacher will respect his decision and give him a high grade." },
                                { value: "B", text: "B. He might get a lower grade, but he will learn to stand by his beliefs." },
                                { value: "C", text: "C. The teacher will be angry and fail him." }
                            ],
                            feedback: {
                                "A": "This is unlikely, as Ms. Evans has already stated that the project doesn't meet her standards.",
                                "B": "This is the most realistic outcome. By sticking to his vision, he might not get the grade he wants, but he will learn a valuable lesson in artistic integrity and conviction.",
                                "C": "This is an extreme reaction and unlikely for a teacher who is trying to provide guidance."
                            }
                        },
                        {
                            question: "4. What is a key emotional issue for Chris in this scenario?",
                            options: [
                                { value: "A", text: "A. Overcoming procrastination." },
                                { value: "B", text: "B. Managing his time effectively." },
                                { value: "C", text: "C. Coping with criticism and validating his self-worth." }
                            ],
                            feedback: {
                                "A": "The case study states he spent weeks on his project, so procrastination isn't the issue.",
                                "B": "Time management is not the core issue here, as the problem is with the feedback and his feelings.",
                                "C": "Correct. Chris's reaction highlights a core emotional struggle: his feelings of self-worth are tied to the success of his work, and he is struggling to handle criticism."
                            }
                        },
                        {
                            question: "5. What long-term lesson could Chris learn from this experience?",
                            options: [
                                { value: "A", text: "A. To never take art classes again." },
                                { value: "B", text: "B. That all criticism is bad and should be ignored." },
                                { value: "C", text: "C. How to separate his personal feelings from constructive criticism and learn from it." }
                            ],
                            feedback: {
                                "A": "This is a negative, unhelpful lesson to learn from the experience.",
                                "B": "This is an unhelpful lesson and will prevent Chris from growing as an artist.",
                                "C": "That's a great lesson. The most valuable outcome of this experience is for Chris to learn that criticism is not a personal attack, but a tool for improvement."
                            }
                        }
                    ]
                },
                {
                    title: "The Group Project Dilemma: A Case Study",
                    story: `
                        <p>Liam, Sarah, and Chloe were assigned a group project for their history class. The project was worth a significant portion of their final grade. Liam and Sarah were diligent, meeting regularly to work on their sections and contributing equally. Chloe, however, was often absent from meetings and her work was consistently late and incomplete.</p>
                        <p>As the deadline approached, Liam and Sarah realized Chloe's lack of effort would hurt their grade. They debated whether to confront her, complete her work for her, or tell their teacher. They felt it was unfair to do all the work, but they were also worried about creating conflict and potentially getting a bad grade if the teacher saw the missing work.</p>
                        <p>Liam wanted to talk to Chloe first to understand her situation, while Sarah felt it was a waste of time and they should just finish her part of the project to ensure a good grade. The tension was building, and they were running out of time to make a decision.</p>
                    `,
                    quiz: {
                        question: "What is the main challenge Liam and Sarah are facing?",
                        options: [
                            { value: "A", text: "A. They don't have enough time to complete the project." },
                            { value: "B", text: "B. They are struggling with the project's topic." },
                            { value: "C", text: "C. They are dealing with an uncooperative group member." },
                            { value: "D", text: "D. They don't have access to the necessary resources." }
                        ],
                        correctAnswer: "C",
                        feedback: {
                            "A": "While time is a factor, the core problem stems from the lack of contribution from a group member.",
                            "B": "The story doesn't mention any issues with the topic itself, so this is likely not the main challenge.",
                            "C": "That's correct! The central problem is navigating the conflict and uneven workload caused by Chloe's lack of participation.",
                            "D": "The case study doesn't indicate that they lack resources, only that one person isn't doing their part."
                        }
                    },
                    reflectionQuestions: [
                        {
                            question: "1. What is the most responsible first step for Liam and Sarah to take?",
                            options: [
                                { value: "A", text: "A. Finish Chloe's work without telling her." },
                                { value: "B", text: "B. Confront Chloe in a private setting to understand her situation." },
                                { value: "C", text: "C. Immediately go to the teacher to report Chloe." }
                            ],
                            feedback: {
                                "A": "While this might save your grade in the short term, it teaches Chloe that her behavior has no consequences and is unfair to you and Liam.",
                                "B": "This is the most responsible first step. By talking to Chloe first, you show empathy and give her a chance to explain her situation and fix the problem before involving an authority figure.",
                                "C": "Going directly to the teacher can escalate the situation and may not be necessary. It also doesn't give Chloe a chance to own her mistake."
                            }
                        },
                        {
                            question: "2. If they complete Chloe's work for her, what is the most likely long-term outcome?",
                            options: [
                                { value: "A", text: "A. They will get a good grade and everything will be fine." },
                                { value: "B", text: "B. They will set a precedent that it's okay for Chloe to not do her work in the future." },
                                { value: "C", text: "C. Chloe will feel guilty and help them on the next project." }
                            ],
                            feedback: {
                                "A": "While you might get a good grade, the underlying issue of Chloe's behavior remains and could cause problems in the future.",
                                "B": "That's a key risk. By doing her work, you are effectively enabling her behavior and making it more likely that she will repeat it in the future.",
                                "C": "This is an optimistic outcome that is unlikely to happen without a direct conversation."
                            }
                        },
                        {
                            question: "3. What skill are Liam and Sarah primarily developing by trying to solve this conflict?",
                            options: [
                                { value: "A", text: "A. Time management." },
                                { value: "B", text: "B. Subject matter expertise." },
                                { value: "C", text: "C. Communication and problem-solving." }
                            ],
                            feedback: {
                                "A": "While time management is important for a group project, it's not the primary skill they are developing in this situation.",
                                "B": "The case study doesn't indicate a lack of subject matter expertise, so this isn't the core skill being developed.",
                                "C": "That's correct. Navigating this conflict teaches them how to communicate difficult feelings and collaboratively solve problems, which are crucial life skills."
                            }
                        },
                        {
                            question: "4. What might be an underlying issue for Chloe's behavior?",
                            options: [
                                { value: "A", text: "A. She is simply lazy and doesn't care." },
                                { value: "B", text: "B. She is overwhelmed with other classes or personal issues." },
                                { value: "C", text: "C. She doesn't like Liam and Sarah." }
                            ],
                            feedback: {
                                "A": "While this is a possible reason, assuming laziness without a conversation is often unfair. There could be other factors at play.",
                                "B": "This is a good point to consider. Sometimes, people's lack of participation is a symptom of being overwhelmed, rather than a lack of caring.",
                                "C": "There is nothing in the case study to suggest that she has a personal dislike for her teammates."
                            }
                        },
                        {
                            question: "5. How could this experience affect the group's relationships in the future?",
                            options: [
                                { value: "A", text: "A. Their friendship will be ruined forever." },
                                { value: "B", text: "B. If they handle it well, it could strengthen their ability to work through conflict." },
                                { value: "C", text: "C. They will all become best friends." }
                            ],
                            feedback: {
                                "A": "This is a pessimistic outlook. While conflict can strain relationships, it doesn't always have to end them.",
                                "B": "Exactly. A well-handled conflict can build trust and show that a friendship is strong enough to withstand difficult conversations.",
                                "C": "This is an overly optimistic outcome. A friendship might not be a direct result of the situation, but the ability to work together is a positive outcome."
                            }
                        }
                    ]
                },
                {
                    title: "The Team Captain: A Case Study",
                    story: `
                        <p>As the captain of the school soccer team, Jordan was respected by his teammates. This season, a new student named Leo joined the team. Leo was enthusiastic and a hard worker, but his soccer skills were not as strong as the other players. During practice, some of the more experienced players started to make quiet jokes about Leo's performance, which made him visibly uncomfortable.</p>
                        <p>Jordan noticed the tension. He felt a responsibility to both his team's performance and to creating a supportive environment. He had to decide how to handle the situation: should he ignore the comments to avoid conflict with his friends and senior players, or should he step in and defend Leo, potentially risking a rift within the team?</p>
                    `,
                    quiz: {
                        question: "What is the team captain's primary responsibility in this scenario?",
                        options: [
                            { value: "A", text: "A. To win the game at all costs." },
                            { value: "B", text: "B. To make sure the team's skills are strong." },
                            { value: "C", text: "C. To balance team performance with creating a supportive environment." },
                            { value: "D", text: "D. To ignore new players and focus on the experienced ones." }
                        ],
                        correctAnswer: "C",
                        feedback: {
                            "A": "While winning is a goal, a good leader knows that a healthy team culture is essential for long-term success.",
                            "B": "Skill is important, but a leader's responsibility goes beyond just performance. It's about creating a safe and inclusive environment for everyone.",
                            "C": "That's correct! Jordan's main dilemma is balancing the team's goals with the need for a respectful and supportive environment for all players.",
                            "D": "Ignoring a new player is not the responsibility of a captain. A captain should work to integrate all players into the team."
                        }
                    },
                    reflectionQuestions: [
                        {
                            question: "1. What is the main conflict Jordan is facing?",
                            options: [
                                { value: "A", text: "A. How to win the next game." },
                                { value: "B", text: "B. Balancing loyalty to his teammates with his responsibility as a leader." },
                                { value: "C", text: "C. Deciding if Leo is a good player." }
                            ],
                            feedback: {
                                "A": "While winning is a goal, the core problem is a social conflict, not a strategic one.",
                                "B": "That's a key insight. Jordan feels a pull between his friends and his duty to create a positive team culture.",
                                "C": "This isn't the main conflict. The case study states Leo is a hard worker, so the issue isn't whether he's a 'good' player, but how his teammates are treating him."
                            }
                        },
                        {
                            question: "2. What is the most effective way for Jordan to address the issue?",
                            options: [
                                { value: "A", text: "A. Yell at the teammates who are making jokes." },
                                { value: "B", text: "B. Pull the players aside and talk to them privately about respect and teamwork." },
                                { value: "C", text: "C. Ignore the comments and hope they stop on their own." }
                            ],
                            feedback: {
                                "A": "Yelling can escalate the conflict and create a hostile environment. It is not an effective way to communicate.",
                                "B": "This is a great approach. Talking to them privately shows respect and gives them a chance to understand the impact of their actions without being publicly shamed.",
                                "C": "Ignoring the problem will likely lead to it getting worse and may cause Leo to feel isolated and leave the team."
                            }
                        },
                        {
                            question: "3. If Jordan chooses to ignore the situation, what could be the consequence for the team?",
                            options: [
                                { value: "A", text: "A. The team will become more unified." },
                                { value: "B", text: "B. The jokes will stop, and Leo will feel accepted." },
                                { value: "C", text: "C. It could lead to a toxic team environment, lower morale, and Leo leaving the team." }
                            ],
                            feedback: {
                                "A": "This is an unlikely outcome. Unresolved conflict typically leads to division, not unity.",
                                "B": "Ignoring a problem rarely makes it go away. It is more likely to make the situation worse for Leo.",
                                "C": "That's right. The lack of action from a leader can be interpreted as approval of the behavior, which can destroy team morale and cohesion."
                            }
                        },
                        {
                            question: "4. How might this experience affect Leo?",
                            options: [
                                { value: "A", text: "A. He will feel more motivated and respected by the team." },
                                { value: "B", text: "B. He might feel alienated and lose confidence." },
                                { value: "C", text: "C. He will become a better player." }
                            ],
                            feedback: {
                                "A": "This is a positive outcome that is unlikely to happen without intervention from the captain.",
                                "B": "That's the most likely outcome. The teasing can lead to a sense of isolation, making him feel like he doesn't belong and hurting his confidence.",
                                "C": "This is a potential outcome, but it is not directly related to the social conflict he is experiencing."
                            }
                        },
                        {
                            question: "5. What does this case study teach about leadership?",
                            options: [
                                { value: "A", text: "A. A good leader prioritizes winning above all else." },
                                { value: "B", text: "B. A good leader must be able to handle difficult social situations and prioritize a positive team culture." },
                                { value: "C", text: "C. A good leader is the best player on the team." }
                            ],
                            feedback: {
                                "A": "While winning is important, prioritizing it at the expense of a healthy team environment is not a sign of good leadership.",
                                "B": "Correct. This case study shows that true leadership isn't just about skill or strategy; it's about courageously addressing difficult social issues for the good of the team.",
                                "C": "This is not true. A leader can be an average player but a great leader who inspires and guides the team to success."
                            }
                        }
                    ]
                },
                {
                    title: "The Friendship Test: A Case Study",
                    story: `
                        <p>Sarah's best friend, Mia, has recently started hanging out with a new group of friends. Sarah notices that whenever Mia is with this new group, she seems to change. She starts making sarcastic remarks about old friends, including Sarah, and avoids talking about their shared interests. One afternoon, Sarah sees a post on social media of Mia and her new friends at a movie they had all planned to see together, but Sarah was never invited.</p>
                        <p>Sarah feels hurt and confused. She doesn't know if she should confront Mia about her behavior, ignore it and hope it changes, or start pulling away from the friendship. She values her friendship with Mia but feels like she's losing the person she used to know. The situation is making her question her self-worth and her place in their friendship.</p>
                    `,
                    quiz: {
                        question: "What is the main conflict Sarah is facing?",
                        options: [
                            { value: "A", text: "A. She is worried about her grades in school." },
                            { value: "B", text: "B. She is unsure how to address a changing friendship and hurt feelings." },
                            { value: "C", text: "C. She wants to join the new group of friends but doesn't know how." },
                            { value: "D", text: "D. She is jealous of Mia's new friends." }
                        ],
                        correctAnswer: "B",
                        feedback: {
                            "A": "The case study does not mention her grades, so this is not the main conflict.",
                            "B": "That's correct! The main conflict for Sarah is emotional and relational. She's dealing with the uncertainty and pain of a changing friendship.",
                            "C": "This might be a part of it, but the core issue is the hurt and confusion caused by Mia's behavior, not just a desire to join the new group.",
                            "D": "While jealousy may be a feeling Sarah is experiencing, the case study states she feels hurt and confused, which indicates a deeper emotional conflict."
                        }
                    },
                    reflectionQuestions: [
                        {
                            question: "1. What is the most mature way for Sarah to handle this situation?",
                            options: [
                                { value: "A", text: "A. Post a passive-aggressive message on social media." },
                                { value: "B", text: "B. Have an open and honest conversation with Mia about her feelings." },
                                { value: "C", text: "C. Immediately end the friendship without explanation." }
                            ],
                            feedback: {
                                "A": "This is a passive and indirect way to express her feelings. It is likely to create more drama and conflict.",
                                "B": "That's a great approach. By talking directly with Mia, Sarah is showing maturity and giving Mia a chance to explain her side and understand how her actions have affected Sarah.",
                                "C": "Ending the friendship immediately can be an impulsive choice that Sarah might regret. It is also an unkind way to end a friendship."
                            }
                        },
                        {
                            question: "2. What is the most likely reason Mia's behavior has changed?",
                            options: [
                                { value: "A", text: "A. She is trying to fit in with her new friends." },
                                { value: "B", text: "B. She secretly hates Sarah and her old friends." },
                                { value: "C", text: "C. She is trying to get Sarah to join the new group." }
                            ],
                            feedback: {
                                "A": "This is the most likely reason. Sometimes, people change their behavior to fit into a new social group, even if it means alienating their old friends.",
                                "B": "This is a strong assumption that is not supported by the information in the case study.",
                                "C": "While Mia might want Sarah to join the group, the sarcastic remarks suggest she is distancing herself from her old friends."
                            }
                        },
                        {
                            question: "3. What is the main emotional issue for Sarah in this case study?",
                            options: [
                                { value: "A", text: "A. Dealing with her schoolwork." },
                                { value: "B", text: "B. Dealing with her parents." },
                                { value: "C", text: "C. Navigating feelings of betrayal and insecurity in a changing friendship." }
                            ],
                            feedback: {
                                "A": "The case study does not mention her schoolwork, so this is not the main issue.",
                                "B": "The case study does not mention her parents, so this is not the main issue.",
                                "C": "That's correct. The core of Sarah's struggle is dealing with the emotional pain of feeling left behind and questioning her value in the friendship."
                            }
                        },
                        {
                            question: "4. What could Sarah do to find her own sense of self-worth outside of this friendship?",
                            options: [
                                { value: "A", text: "A. Focus on new hobbies or activities that make her happy." },
                                { value: "B", text: "B. Wait for Mia to come back to their old friendship." },
                                { value: "C", text: "C. Try to force herself into Mia's new friend group." }
                            ],
                            feedback: {
                                "A": "This is a great idea. Focusing on her own interests and personal growth can help her feel more confident and less reliant on one person for her self-worth.",
                                "B": "This is a passive approach that could lead to more disappointment and hurt feelings.",
                                "C": "Forcing herself into a new friend group is likely to make her feel more rejected and could damage her sense of self-worth."
                            }
                        },
                        {
                            question: "5. How might this experience help Sarah grow?",
                            options: [
                                { value: "A", text: "A. It will make her more suspicious of all her friends." },
                                { value: "B", text: "B. It will teach her to be more assertive and to value her own feelings." },
                                { value: "C", text: "C. It will teach her that friendships never last." }
                            ],
                            feedback: {
                                "A": "This is a negative outcome that can lead to unhealthy relationships in the future.",
                                "B": "That's the best outcome. This experience can teach Sarah to stand up for herself, communicate her needs, and build stronger, healthier friendships in the future.",
                                "C": "This is a pessimistic outlook that is not necessarily true."
                            }
                        }
                    ]
                },
                {
                    title: "The Ethical Test: A Case Study",
                    story: `
                        <p>Maya was a top student, known for her honesty and integrity. One day, during a major chemistry exam, she noticed her friend, Ben, was looking at notes hidden in his sleeve. Ben was struggling in the class, and this exam was crucial for his grade. Maya knew that if she reported him, he could face serious consequences, including failing the course. If she said nothing, she would be complicit in his cheating, which went against everything she believed in.</p>
                        <p>The teacher was not in a position to see what was happening. Maya felt a mix of loyalty to her friend and a strong sense of right and wrong. She was caught in a difficult dilemma. Should she risk her friendship to uphold her values, or should she protect her friend and keep quiet?</p>
                    `,
                    quiz: {
                        question: "What is Maya's core conflict?",
                        options: [
                            { value: "A", text: "A. She is worried about her own test score." },
                            { value: "B", text: "B. She is caught between loyalty to a friend and her personal ethics." },
                            { value: "C", text: "C. She fears getting in trouble with the teacher." },
                            { value: "D", text: "D. She doesn't understand the chemistry concepts." }
                        ],
                        correctAnswer: "B",
                        feedback: {
                            "A": "While she might be worried about her test score, this is not the main conflict mentioned in the story.",
                            "B": "That's correct! The core dilemma is the conflict between her loyalty to her friend and her personal code of ethics and integrity.",
                            "C": "The story says the teacher didn't see Ben cheating, so she is not in danger of getting in trouble.",
                            "D": "The story states she is a top student, which implies she understands the subject matter."
                        }
                    },
                    reflectionQuestions: [
                        {
                            question: "1. What is the main ethical dilemma Maya is facing?",
                            options: [
                                { value: "A", text: "A. The conflict between personal gain and social responsibility." },
                                { value: "B", text: "B. The conflict between loyalty to a friend and upholding academic integrity." },
                                { value: "C", text: "C. The conflict between her own beliefs and the beliefs of the teacher." }
                            ],
                            feedback: {
                                "A": "The case study does not mention her personal gain, so this is not the main dilemma.",
                                "B": "Correct. This is a classic ethical dilemma where a person must choose between two conflicting values: friendship and honesty.",
                                "C": "The conflict is not between her beliefs and the teacher's beliefs, but rather her loyalty and integrity."
                            }
                        },
                        {
                            question: "2. What is the most empathetic action Maya could take?",
                            options: [
                                { value: "A", text: "A. Immediately report Ben to the teacher." },
                                { value: "B", text: "B. Ignore the cheating to protect her friend." },
                                { value: "C", text: "C. Speak with Ben privately after the exam to address her concerns and encourage him to confess." }
                            ],
                            feedback: {
                                "A": "While this upholds academic integrity, it lacks empathy for Ben's difficult situation.",
                                "B": "This shows loyalty, but it's not empathetic. It enables Ben's behavior and puts Maya's integrity at risk.",
                                "C": "This is a great option. It shows both empathy for Ben's struggle and a commitment to academic integrity by encouraging him to take responsibility."
                            }
                        },
                        {
                            question: "3. What might be an underlying issue for Ben's cheating?",
                            options: [
                                { value: "A", text: "A. He simply doesn't like the teacher." },
                                { value: "B", text: "B. He feels immense pressure to succeed and is afraid of failing." },
                                { value: "C", text: "C. He doesn't think cheating is a big deal." }
                            ],
                            feedback: {
                                "A": "While he might not like the teacher, the case study states he is struggling in the class, which is a more likely reason for his cheating.",
                                "B": "This is the most likely underlying issue. Cheating is often a symptom of fear and pressure, not a lack of morals.",
                                "C": "While this is a possibility, it is a negative assumption that is not supported by the information in the case study."
                            }
                        },
                        {
                            question: "4. If Maya reports Ben, what is the most likely outcome for their friendship?",
                            options: [
                                { value: "A", text: "A. The friendship will be over because Ben will feel betrayed." },
                                { value: "B", text: "B. The friendship will grow stronger because Ben will appreciate her honesty." },
                                { value: "C", text: "C. Their friendship will be unaffected." }
                            ],
                            feedback: {
                                "A": "This is the most likely outcome in the short term. Ben will feel betrayed and may end the friendship, at least for a while.",
                                "B": "This is an optimistic outcome that is unlikely to happen immediately. It might happen in the long run, but only after some time and healing.",
                                "C": "It is highly unlikely that their friendship would be unaffected by such a major conflict."
                            }
                        },
                        {
                            question: "5. What long-term lesson could Ben learn if Maya confronts him?",
                            options: [
                                { value: "A", text: "A. That his friends will always cover for him." },
                                { value: "B", text: "B. That he can get away with cheating if he is careful." },
                                { value: "C", text: "C. The importance of integrity and the value of true friendship." }
                            ],
                            feedback: {
                                "A": "This is an unhelpful lesson to learn. It would only encourage him to cheat again.",
                                "B": "This is a negative outcome that would not help him grow as a person.",
                                "C": "That's the ideal outcome. A difficult conversation could teach him a valuable lesson about the importance of being honest and the value of a friend who holds him to a high standard."
                            }
                        }
                    ]
                }
            ];

            // Show a temporary message box with a given text
            const showMessage = (text, isSuccess = true) => {
                messageBox.textContent = text;
                messageBox.classList.remove('bg-green-500', 'bg-red-500');
                if (isSuccess) {
                    messageBox.classList.add('bg-green-500');
                } else {
                    messageBox.classList.add('bg-red-500');
                }
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 3000);
            };

            const updateNavigationButtons = () => {
                previousBtn.disabled = currentCaseStudyIndex === 0;
                if (currentCaseStudyIndex === 0) {
                    previousBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    previousBtn.classList.remove('opacity-100', 'cursor-pointer');
                } else {
                    previousBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    previousBtn.classList.add('opacity-100', 'cursor-pointer');
                }

                nextBtn.disabled = currentCaseStudyIndex === caseStudies.length - 1;
                 if (currentCaseStudyIndex === caseStudies.length - 1) {
                    nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    nextBtn.classList.remove('opacity-100', 'cursor-pointer');
                } else {
                    nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    nextBtn.classList.add('opacity-100', 'cursor-pointer');
                }
            };
            
            const loadCaseStudy = (index) => {
                const caseStudy = caseStudies[index];
                caseStudyTitle.textContent = caseStudy.title;
                caseStudyStory.innerHTML = caseStudy.story;
                
                // Load comprehension quiz
                quizQuestion.textContent = caseStudy.quiz.question;
                quizOptionsContainer.innerHTML = '';
                caseStudy.quiz.options.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'radio-label';
                    label.innerHTML = `
                        <input type="radio" name="quiz-q1" value="${option.value}">
                        <span class="text-lg">${option.text}</span>
                    `;
                    quizOptionsContainer.appendChild(label);
                });
                
                // Load reflection questions
                reflectionQuestionsContainer.innerHTML = '';
                caseStudy.reflectionQuestions.forEach((refQ, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.innerHTML = `<h3 class="text-xl font-semibold text-gray-700 mb-2">${refQ.question}</h3>`;
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'reflection-question-options space-y-4';
                    refQ.options.forEach((option, oIndex) => {
                        const label = document.createElement('label');
                        label.innerHTML = `
                            <input type="radio" name="q${qIndex + 1}-response" value="${option.value}" class="mr-2">
                            <span>${option.text}</span>
                        `;
                        optionsDiv.appendChild(label);
                        label.addEventListener('click', () => {
                            showMessage(refQ.feedback[option.value], option.value === refQ.correctAnswer);
                        });
                    });
                    questionDiv.appendChild(optionsDiv);
                    reflectionQuestionsContainer.appendChild(questionDiv);
                });

                // Clear any previous selection and feedback
                document.querySelectorAll('input[name="quiz-q1"]').forEach(input => input.checked = false);
                const labels = document.querySelectorAll('.radio-label');
                labels.forEach(label => label.classList.remove('correct', 'incorrect'));
                
                // Reset quiz and continue button state
                checkAnswerBtn.classList.remove('hidden');
                continueBtn.classList.add('hidden');
                
                updateNavigationButtons();
            };
            
            checkAnswerBtn.addEventListener('click', () => {
                const selectedOption = document.querySelector('input[name="quiz-q1"]:checked');
                const labels = document.querySelectorAll('.radio-label');
                const currentCaseStudy = caseStudies[currentCaseStudyIndex];

                labels.forEach(label => {
                    label.classList.remove('correct', 'incorrect');
                });

                if (selectedOption) {
                    const feedback = currentCaseStudy.quiz.feedback[selectedOption.value];
                    const isCorrect = selectedOption.value === currentCaseStudy.quiz.correctAnswer;
                    showMessage(feedback, isCorrect);

                    if (isCorrect) {
                        selectedOption.parentElement.classList.add('correct');
                        checkAnswerBtn.classList.add('hidden');
                        continueBtn.classList.remove('hidden');
                    } else {
                        selectedOption.parentElement.classList.add('incorrect');
                    }
                } else {
                    showMessage('Please select an option before checking.', false);
                }
            });

            previousBtn.addEventListener('click', () => {
                if (currentCaseStudyIndex > 0) {
                    currentCaseStudyIndex--;
                    loadCaseStudy(currentCaseStudyIndex);
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentCaseStudyIndex < caseStudies.length - 1) {
                    currentCaseStudyIndex++;
                    loadCaseStudy(currentCaseStudyIndex);
                }
            });
            
            // Hide case study/quiz, show questions on button click
            continueBtn.addEventListener('click', () => {
                document.getElementById('case-study-container').classList.add('opacity-0');
                setTimeout(() => {
                    document.getElementById('case-study-container').classList.add('hidden');
                    questionsContainer.classList.remove('hidden');
                    setTimeout(() => {
                        questionsContainer.classList.remove('opacity-0');
                    }, 50);
                }, 500);
            });

            submitBtn.addEventListener('click', () => {
                const submittedResponses = {};
                for (let i = 1; i <= caseStudies[currentCaseStudyIndex].reflectionQuestions.length; i++) {
                    const responseElement = document.querySelector(`input[name="q${i}-response"]:checked`);
                    if (responseElement) {
                        submittedResponses[`q${i}`] = responseElement.value;
                    } else {
                        submittedResponses[`q${i}`] = 'No answer selected';
                    }
                }
                console.log("Submitted Responses for Case Study " + (currentCaseStudyIndex + 1) + ":", submittedResponses);
                showMessage("Your responses have been saved!");

                if (currentCaseStudyIndex < caseStudies.length - 1) {
                    submitBtn.classList.add('hidden');
                    nextCaseStudyBtn.classList.remove('hidden');
                } else {
                    showMessage("You've completed all the case studies!", true);
                }
            });

            nextCaseStudyBtn.addEventListener('click', () => {
                if (currentCaseStudyIndex < caseStudies.length - 1) {
                    currentCaseStudyIndex++;
                    loadCaseStudy(currentCaseStudyIndex);
                    
                    submitBtn.classList.remove('hidden');
                    nextCaseStudyBtn.classList.add('hidden');

                    document.getElementById('case-study-container').classList.remove('hidden');
                    questionsContainer.classList.add('hidden');
                    setTimeout(() => {
                        document.getElementById('case-study-container').classList.remove('opacity-0');
                        questionsContainer.classList.add('opacity-0');
                    }, 50);
                }
            });

            loadCaseStudy(currentCaseStudyIndex);
        });
        
        // Function to close the welcome modal
        const closeWelcomeModal = () => {
            const welcomeModal = document.getElementById('welcome-modal');
            welcomeModal.style.animation = 'none';
            welcomeModal.style.transform = 'scale(0.8)';
            welcomeModal.style.opacity = '0';
            setTimeout(() => {
                welcomeModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Re-enable scrolling if disabled
            }, 300);
        };
        
        // Show the welcome modal on page load
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeModal = document.getElementById('welcome-modal');
            welcomeModal.style.display = 'flex';
        });
    </script>
</body>
</html>